const t=document.querySelector("button"),e=document.querySelector(".game-score"),i=document.querySelector("tbody");let s=0;const l=new class{constructor(){this.field=o(),this.state="idle",this.score=0,this.currnetBigestNumber=0}getStatus(){"lose"===this.state&&r("message-lose"),"playing"===this.state&&this.restart()}start(){return this.state="wait",e.textContent=0,"wait"===this.state&&(s=0),this.field=o(),r("message-rule"),f(this.field,this.state),f(this.field,this.state),this.state="playing",h(this.field,this.state),this.field}restart(){t.removeAttribute("style"),t.classList.remove("start"),t.classList.add("restart"),t.textContent="Restart"}moveRight(){g(this.field,"right")&&(d(this.field,"right"),f(this.field)),this.moveEngine()}moveLeft(){g(this.field,"left")&&(d(this.field,"left"),f(this.field)),this.moveEngine()}moveUp(){m(this.field,"up")&&(c(this.field,"up"),f(this.field)),this.moveEngine()}moveDown(){m(this.field,"down")&&(c(this.field,"down"),f(this.field)),this.moveEngine()}moveEngine(){h(this.field),!1===a(this.field)&&!1===g(this.field,"right")&&!1===g(this.field,"left")&&!1===m(this.field,"up")&&!1===m(this.field,"down")&&(this.state="lose"),this.getStatus()}};t.addEventListener("click",()=>{l.start()});const n=document.querySelector(".message-rule");function r(t){for(let e of[...document.querySelector(".message-container").children])if(e.classList.contains(t)){e.classList.toggle("hidden",!1);continue}else e.classList.add("hidden")}function o(){let t=[...i.querySelectorAll("tr")],e=t[0].children.length,s=[];for(let i=0;i<t.length;i++)s.push(Array(e).fill(0));return s}function f(t,e){if(a(t)){let i=.9>Math.random()?2:4,s=[Math.floor(0+4*Math.random()),Math.floor(0+4*Math.random())],l=t[s[0]];"wait"===e&&(i=2),0===l[s[1]]?l[s[1]]=i:f(t)}else r("message-lose");return t}function a(t){for(let e of t)if(!0===e.some(t=>0===t))return!0;return!1}function h(t){for(let e=0;e<t.length;e++){let s=t[e];for(let t=0;t<s.length;t++){let l=i.rows[e].cells[t];if(0===s[t])l.removeAttribute("class"),l.classList.add("field-cell"),l.textContent="";else{l.removeAttribute("class"),l.classList.add("field-cell");let e=`field-cell--${s[t]}`;l.classList.add(e),l.textContent=s[t],2048===s[t]&&r("message-win")}}}}function d(t,e){for(let i=0;i<t.length;i++)t[i]=u(t[i],e);return t}function c(t,e){for(let i=0;i<t.length;i++){let s=[],l=t[0][i],n=t[1][i],r=t[2][i],o=t[3][i];s.push(l,n,r,o);let[f,a,h,d]=s=u(s,e);t[0][i]=f,t[1][i]=a,t[2][i]=h,t[3][i]=d}}function u(t,i){let l=t.filter(t=>t>0);if(l.length>1){for(let t=0;t<l.length-1;t++)l[t]===l[t+1]&&(l[t]=2*l[t],l[t+1]=0,s+=l[t]);e.textContent=s}let n=l.filter(t=>t>0);for(;n.length<4;)switch(i){case"right":case"down":n.unshift(0);break;case"left":case"up":n.push(0)}return n}function g(t,e){for(let i of t){let t=i.find(t=>t>0);if(void 0===t)continue;let s=i.indexOf(t);switch("left"===e&&(t=i.findLast(t=>t>0),s=i.lastIndexOf(t)),e){case"right":if(0===i[s+1])return!0;for(let t=s;t<i.length-1;t++)if(i[t]===i[t+1]||0===i[t+1])return!0;break;case"left":if(0===i[s-1])return!0;for(let t=s;t>0;t--)if(i[t]===i[t-1]||0===i[t-1])return!0}}return!1}function m(t,e){for(let i=0;i<t.length;i++){let s=[];s.push(t[0][i],t[1][i],t[2][i],t[3][i]);let l=s.find(t=>t>0);if(void 0===l)continue;let n=s.indexOf(l);switch("up"===e&&(l=s.findLast(t=>t>0),n=s.lastIndexOf(l)),e){case"down":if(0===s[n+1])return!0;for(let t=n;t<s.length-1;t++)if(s[t]===s[t+1]||0===s[t+1])return!0;break;case"up":if(0===s[n-1])return!0;for(let t=n;t>0;t--)if(s[t]===s[t-1]||0===s[t-1])return!0}}return!1}document.addEventListener("keyup",t=>{if("playing"!==l.state||n.classList.contains("hidden"))return!1;switch(t.code){case"ArrowRight":l.moveRight();break;case"ArrowLeft":l.moveLeft();break;case"ArrowUp":l.moveUp();break;case"ArrowDown":l.moveDown()}});
//# sourceMappingURL=index.cec76b12.js.map
